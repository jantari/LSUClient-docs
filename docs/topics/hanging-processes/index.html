<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Hanging processes # By nature, LSUClient has to run and wait on external processes such as hardware-detection routines or driver installers to complete.
The executables and installers Lenovo bundles in their packages are generally designed to run silently and without user interaction. This means LSUClient can just execute these processes, wait for them to complete and then continue. However, it is unfortunately sometimes the case that a process LSUClient is waiting on gets stuck indefinitely and never exits on its own."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Troubleshooting Hanging Processes"><meta property="og:description" content="Hanging processes # By nature, LSUClient has to run and wait on external processes such as hardware-detection routines or driver installers to complete.
The executables and installers Lenovo bundles in their packages are generally designed to run silently and without user interaction. This means LSUClient can just execute these processes, wait for them to complete and then continue. However, it is unfortunately sometimes the case that a process LSUClient is waiting on gets stuck indefinitely and never exits on its own."><meta property="og:type" content="article"><meta property="og:url" content="https://jantari.github.io/LSUClient-docs/docs/topics/hanging-processes/"><meta property="article:section" content="docs"><title>Troubleshooting Hanging Processes | LSUClient Documentation</title><link rel=manifest href=/LSUClient-docs/manifest.json><link rel=icon href=/LSUClient-docs/favicon.png type=image/x-icon><link rel=stylesheet href=/LSUClient-docs/book.min.c88b93b9ecb16d5abb0111a0a8bdc0745499151283aee71eb7ddec30fd96d239.css integrity="sha256-yIuTueyxbVq7ARGgqL3AdFSZFRKDrucet93sMP2W0jk=" crossorigin=anonymous><script defer src=/LSUClient-docs/flexsearch.min.js></script>
<script defer src=/LSUClient-docs/en.search.min.8f26f74b547fd0c559344b0f354901a2b9cc3581cc0ce27fd65cf1c39977a073.js integrity="sha256-jyb3S1R/0MVZNEsPNUkBornMNYHMDOJ/1lzxw5l3oHM=" crossorigin=anonymous></script>
<link rel=stylesheet type=text/css href=/LSUClient-docs/nord.css><link rel=stylesheet type=text/css href=/LSUClient-docs/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/LSUClient-docs/><span>LSUClient Documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Topics</span><ul><li><a href=/LSUClient-docs/docs/topics/examples/>Getting Started</a></li><li><a href=/LSUClient-docs/docs/topics/best-practices/>Best Practices</a></li><li><a href=/LSUClient-docs/docs/topics/bios-and-firmware/>BIOS/UEFI and Firmware Updates</a></li><li><a href=/LSUClient-docs/docs/topics/hanging-processes/ class=active>Troubleshooting Hanging Processes</a></li><li><a href=/LSUClient-docs/docs/topics/self-hosted-repositories/>Self-Hosted Repositories</a></li><li><a href=/LSUClient-docs/docs/topics/versioning/>Versioning</a></li></ul></li><li class=book-section-flat><span>Cmdlet Reference</span><ul><li><a href=/LSUClient-docs/docs/cmdlets/get-lsuclientconfiguration/>Get-LSUClientConfiguration</a></li><li><a href=/LSUClient-docs/docs/cmdlets/get-lsupdate/>Get-LSUpdate</a></li><li><a href=/LSUClient-docs/docs/cmdlets/install-lsupdate/>Install-LSUpdate</a></li><li><a href=/LSUClient-docs/docs/cmdlets/save-lsupdate/>Save-LSUpdate</a></li><li><a href=/LSUClient-docs/docs/cmdlets/set-lsuclientconfiguration/>Set-LSUClientConfiguration</a></li></ul></li></ul><ul><li><a href=https://github.com/jantari/LSUClient target=_blank rel=noopener>ðŸ”— GitHub</a></li><li><a href=https://github.com/jantari/LSUClient/releases target=_blank rel=noopener>ðŸ”— Release Notes</a></li><li><a href=https://www.powershellgallery.com/packages/LSUClient/ target=_blank rel=noopener>ðŸ”— PowerShell Gallery</a></li><li><a href=https://github.com/alex-shpak/hugo-book target=_blank rel=noopener>ðŸ”— Hugo Book Theme</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/LSUClient-docs/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Troubleshooting Hanging Processes</strong>
<label for=toc-control><img src=/LSUClient-docs/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#fixing-hanging-processes>Fixing hanging processes</a><ul><li><a href=#hanging-processes-in-session-0>Hanging processes in session 0</a></li></ul></li><li><a href=#killing-hanging-processes>Killing hanging processes</a><ul><li><a href=#example-of-a-package-installation-exceeding-the-maxinstallerruntime>Example of a package installation exceeding the MaxInstallerRuntime</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=hanging-processes>Hanging processes
<a class=anchor href=#hanging-processes>#</a></h1><p>By nature, LSUClient has to run and wait on external processes such as hardware-detection routines or driver installers to complete.</p><p>The executables and installers Lenovo bundles in their packages are generally designed to run silently and without user interaction.
This means LSUClient can just execute these processes, wait for them to complete and then continue. However, it is unfortunately
sometimes the case that a process LSUClient is waiting on gets stuck indefinitely and never exits on its own.</p><p>Starting with Version 1.4.2, LSUClient will log warnings about any long-running processes at regular intervals so that
such problem cases can be easily identified.</p><p>If you run into this, you should proceed with these two options:</p><h2 id=fixing-hanging-processes>Fixing hanging processes
<a class=anchor href=#fixing-hanging-processes>#</a></h2><p>It is always ideal to have a process finish successfully instead of hanging.</p><p>First, if you run LSUClient remotely or in an unattended scenario, make sure you are only installing
packages that can be installed silently and non-interactively in the first place as covered in the
<a href=/LSUClient-docs/docs/topics/examples/#install-only-packages-that-can-be-installed-silently-and-non-interactively>best practices article</a>.</p><p>Often when a process is stuck indefinitely, it is because it did not run entirely silently, opened up a graphical window and is waiting
for user input to continue. When this happens it can easily be seen by someone in front of the computer, but to also make identifying this
behavior remotely easier (without being in front of the computer), when a process has been running for longer than 5 minutes LSUClient
starts checking for any open windows and if there are any, captures and prints their text contents to the console. An example output of
this can be found <a href=#example-of-a-package-installation-exceeding-the-maxinstallerruntime>below</a>. The messages in the open windows often
explain or can be googled to understand why the problem occurred. Sometimes a process may also leave logfiles that can help troubleshoot
the cause of the hanging.</p><blockquote class="book-hint info">The feature of looking for open windows of a process run by LSUClient was first introduced in version 1.5.0. Then, the check only ran
once when and <em>if</em> the process hit its configured runtime limit. Starting with LSUClient 1.5.3, all processes are investigated periodically
once they&rsquo;ve been running for longer than 5 minutes, independently of a configured runtime limit.</blockquote><p>You can also search the issues on GitHub for the package name and keywords like &ldquo;hang&rdquo; or &ldquo;stuck&rdquo; to see if other people have had the same
problem. For example, <a href=https://github.com/jantari/LSUClient/issues/49>GitHub issue #49</a> details a problem and solution with an Intel Graphics
Driver installer that, despite being run in silent mode, pops up an error message under certain conditions and then sits there indefinitely.</p><h3 id=hanging-processes-in-session-0>Hanging processes in session 0
<a class=anchor href=#hanging-processes-in-session-0>#</a></h3><p>An additional complication is if you run LSUClient (and therefore its child-processes as well) in session 0. Many software deployment solutions,
MDMs, RMMs and other tools you may use to run your LSUClient scripts will run them from a service in session 0. Graphical windows can be created
but are not drawn/rendered in session 0 so if a process is running there and gets stuck due to opening a window and waiting for someone to interact
with it, the window will not be visible and only a limited set of information about it (such as its dimensions) can even be gathered by LSUClient.
Any text inside a window cannot be retrieved and attempts to screenshot the window only show black. If you run LSUClient in session 0 and experience
hanging processes, it is best to reproduce the problem running LSUClient in a graphical logon session (such as via RDP or in front of the physical
device) to ensure any opened windows and their contents are fully drawn and visible. When running with the <code>-Debug</code> parameter, LSUClient prints the
session ID it and processes started by it are running in, e.g.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>DEBUG: Process IDs in job (without runspace): 14076
</span></span><span class="line hl"><span class=cl>DEBUG: (Current session ID: 1, Environment.UserInteractive: True)
</span></span><span class=line><span class=cl>WARNING: Process &#39;C:\Windows\Temp\n2hdr35w\installer.exe&#39; has been running for 00:05:00.1928042
</span></span><span class=line><span class=cl>WARNING: 14076: &#39;Installer&#39; started at 20:34:04.3837487
</span></span><span class="line hl"><span class=cl>DEBUG: Process 14076 (&#39;Installer&#39;):
</span></span><span class="line hl"><span class=cl>DEBUG:   Session: 1
</span></span><span class=line><span class=cl>DEBUG:   CommandLine: &#34;C:\Windows\Temp\n2hdr35w\installer.exe&#34; -s
</span></span><span class=line><span class=cl>DEBUG:   StartTime: 20:34:04.3837487
</span></span><span class=line><span class=cl>DEBUG:   Parent Id: 14384
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><h2 id=killing-hanging-processes>Killing hanging processes
<a class=anchor href=#killing-hanging-processes>#</a></h2><p>Starting with LSUClient 1.5.0, you can configure runtime limits for external processes. When a process exceeds the limit, it is forcefully terminated.
Killing a running process is not ideal, but as a last resort it can be a better option than having your entire LSUClient script halt indefinitely, especially in
unattended scenarios.</p><p>These time limits are configured with <code>Set-LSUClientConfiguration</code>, see the <a href=/LSUClient-docs/docs/cmdlets/set-lsuclientconfiguration/><code>Set-LSUClientConfiguration</code> cmdlet help</a>
for details and examples on how. You can get the current limit values with <code>Get-LSUClientConfiguration</code>. Some limits may be enabled by default.</p><blockquote class="book-hint danger"><p>As a precaution LSUClient does not enforce the MaxInstallerRuntime setting for BIOS and firmware update installers.</p><p>However this automatic safeguard is based on package metadata such as Type, Category, Title etc. and therefore may not be perfect.
If you configure a MaxInstallerRuntime, always be aware of the risk of potentially forcefully stopping an in-progress firmware update!</p></blockquote><p>When a package install process exceeds the <code>MaxInstallerRuntime</code> time limit and is killed, the <code>FailureReason</code> of the <code>PackageInstallResult</code> object returned
by <code>Install-LSUpdate</code> will be set to <code>PROCESS_KILLED_TIMELIMIT</code>. When this happens you should look into what caused the process to run for so long and whether
it can be fixed.</p><p>For example, reproducing a problem with an Intel Graphics Driver installer that was <a href=https://github.com/jantari/LSUClient/issues/49>reported on GitHub</a>
now gets logged with the following output when it is killed:</p><h3 id=example-of-a-package-installation-exceeding-the-maxinstallerruntime>Example of a package installation exceeding the MaxInstallerRuntime
<a class=anchor href=#example-of-a-package-installation-exceeding-the-maxinstallerruntime>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>jantari@AMDESKTOP:~
</span></span><span class=line><span class=cl>â””â”€ PS&gt; Set-LSUClientConfiguration -MaxInstallerRuntime (New-TimeSpan -Minutes 6)
</span></span><span class=line><span class=cl>jantari@AMDESKTOP:~
</span></span><span class=line><span class=cl>â””â”€ PS&gt; Install-LSUpdate -Package $igfx -Path C:\Windows\Temp -Verbose
</span></span><span class=line><span class=cl>VERBOSE: Installing package n2hdr35w ...
</span></span><span class=line><span class=cl>WARNING: Process &#39;C:\Windows\Temp\n2hdr35w\installer.exe&#39; has been running for 00:05:00.0588631
</span></span><span class=line><span class=cl>WARNING: Process has exceeded the configured runtime limit of 00:06:00
</span></span><span class=line><span class=cl>WARNING: Process has windows open, this can help troubleshoot why it timed out:
</span></span><span class=line><span class=cl>WARNING: - Title: -------------------------------------------
</span></span><span class=line><span class=cl>WARNING: HandledStartupErrorWindow
</span></span><span class=line><span class=cl>WARNING: - Content: -----------------------------------------
</span></span><span class=line><span class=cl>WARNING: Graphics Driver Installer
</span></span><span class=line><span class=cl>WARNING:
</span></span><span class=line><span class=cl>WARNING:
</span></span><span class=line><span class=cl>WARNING:
</span></span><span class=line><span class=cl>WARNING: The application cannot be launched.
</span></span><span class=line><span class=cl>WARNING: The application is in an unauthorized location. Please move to a non-system folder.
</span></span><span class=line><span class=cl>WARNING: OK
</span></span><span class=line><span class=cl>WARNING: ----------------------------------------------------
</span></span><span class=line><span class=cl>WARNING: Killing process 13104 &#39;Installer&#39; due to exceeding time limit ...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ID             : n2hdr35w
</span></span><span class=line><span class=cl>Title          : Intel Graphics Driver - 10 (1709 or Later)/11 (21H2 or Later)
</span></span><span class=line><span class=cl>Type           : Driver
</span></span><span class=line><span class=cl>Success        : False
</span></span><span class=line><span class=cl>FailureReason  : PROCESS_KILLED_TIMELIMIT
</span></span><span class=line><span class=cl>PendingAction  : NONE
</span></span><span class=line><span class=cl>ExitCode       : -1
</span></span><span class=line><span class=cl>StandardOutput :
</span></span><span class=line><span class=cl>StandardError  :
</span></span><span class=line><span class=cl>LogOutput      :
</span></span><span class=line><span class=cl>Runtime        : 00:05:59.3823498
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#fixing-hanging-processes>Fixing hanging processes</a><ul><li><a href=#hanging-processes-in-session-0>Hanging processes in session 0</a></li></ul></li><li><a href=#killing-hanging-processes>Killing hanging processes</a><ul><li><a href=#example-of-a-package-installation-exceeding-the-maxinstallerruntime>Example of a package installation exceeding the MaxInstallerRuntime</a></li></ul></li></ul></nav></div></aside></main></body></html>