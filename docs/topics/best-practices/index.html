<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Best Practices
  #


  1. Search for and install updates a few times in a loop
  #

Some packages and updates depend on others already being installed, so they might not show up during the first search for updates.
If you want to make sure &ldquo;everything&rdquo; has been installed and/or updated it is best to re-run
Get-LSUpdate and Install-LSUpdate a few times or until no more updates are found."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://jantari.github.io/LSUClient-docs/docs/topics/best-practices/"><meta property="og:site_name" content="LSUClient Documentation"><meta property="og:title" content="LSUClient Documentation"><meta property="og:description" content="Best Practices # 1. Search for and install updates a few times in a loop # Some packages and updates depend on others already being installed, so they might not show up during the first search for updates. If you want to make sure “everything” has been installed and/or updated it is best to re-run Get-LSUpdate and Install-LSUpdate a few times or until no more updates are found."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>Best Practices | LSUClient Documentation</title><link rel=icon href=/LSUClient-docs/favicon.png><link rel=manifest href=/LSUClient-docs/manifest.json><link rel=canonical href=https://jantari.github.io/LSUClient-docs/docs/topics/best-practices/><link rel=stylesheet href=/LSUClient-docs/book.min.540a93cf27ab36aa2df15ac21012260a3e0e82052ff0d1c2339503a6b7de0dd3.css integrity="sha256-VAqTzyerNqot8VrCEBImCj4OggUv8NHCM5UDprfeDdM=" crossorigin=anonymous><script defer src=/LSUClient-docs/fuse.min.js></script><script defer src=/LSUClient-docs/en.search.min.c02c1d3bfc0fc0ace8fb56c09f4a49e41577a896c7fb79c8eb3761e0a889cb21.js integrity="sha256-wCwdO/wPwKzo+1bAn0pJ5BV3qJbH+3nI6zdh4KiJyyE=" crossorigin=anonymous></script><link rel=stylesheet type=text/css href=/LSUClient-docs/nord.css><link rel=stylesheet type=text/css href=/LSUClient-docs/syntax.css><link rel=stylesheet type=text/css href=/LSUClient-docs/fontawesome/css/fontawesome.css><link rel=stylesheet type=text/css href=/LSUClient-docs/fontawesome/css/brands.css><link rel=stylesheet type=text/css href=/LSUClient-docs/fontawesome/css/solid.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/LSUClient-docs/><span>LSUClient Documentation</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>Topics</span><ul><li><a href=/LSUClient-docs/docs/topics/examples/>Getting Started</a></li><li><a href=/LSUClient-docs/docs/topics/best-practices/ class=active>Best Practices</a></li><li><a href=/LSUClient-docs/docs/topics/bios-and-firmware/>BIOS/UEFI and Firmware Updates</a></li><li><a href=/LSUClient-docs/docs/topics/hanging-processes/>Troubleshooting Hanging Processes</a></li><li><a href=/LSUClient-docs/docs/topics/self-hosted-repositories/>Self-Hosted Repositories</a></li><li><a href=/LSUClient-docs/docs/topics/versioning/>Versioning</a></li></ul></li><li class=book-section-flat><span>Cmdlet Reference</span><ul><li><a href=/LSUClient-docs/docs/cmdlets/expand-lsupdate/>Expand-LSUpdate</a></li><li><a href=/LSUClient-docs/docs/cmdlets/get-lsuclientconfiguration/>Get-LSUClientConfiguration</a></li><li><a href=/LSUClient-docs/docs/cmdlets/get-lsupdate/>Get-LSUpdate</a></li><li><a href=/LSUClient-docs/docs/cmdlets/install-lsupdate/>Install-LSUpdate</a></li><li><a href=/LSUClient-docs/docs/cmdlets/save-lsupdate/>Save-LSUpdate</a></li><li><a href=/LSUClient-docs/docs/cmdlets/set-lsuclientconfiguration/>Set-LSUClientConfiguration</a></li></ul></li><li class=book-section-flat><span>Links</span><ul></ul></li></ul><ul><li><a href target=_blank rel=noopener></a></li></ul><ul><li class=beat-on-hover><a href=https://github.com/jantari/LSUClient target=_blank rel=noopener><i class="fa-brands fa-github"></i>
GitHub</a></li><li class=beat-on-hover><a href=https://github.com/jantari/LSUClient/releases target=_blank rel=noopener><i class="fa-solid fa-list-ul"></i>
Release Notes</a></li><li class=beat-on-hover><a href=https://www.powershellgallery.com/packages/LSUClient/ target=_blank rel=noopener><i class="fa-solid fa-terminal"></i>
PowerShell Gallery</a></li><li class=beat-on-hover><a href=https://github.com/alex-shpak/hugo-book target=_blank rel=noopener><i class="fa-solid fa-paint-roller"></i>
Hugo Book Theme</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/LSUClient-docs/svg/menu.svg class=book-icon alt=Menu></label><h3>Best Practices</h3><label for=toc-control><img src=/LSUClient-docs/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#1-search-for-and-install-updates-a-few-times-in-a-loop>1. Search for and install updates a few times in a loop</a></li><li><a href=#2-download-all-packages-before-starting-to-install-any>2. Download all packages before starting to install any</a></li><li><a href=#3-write-a-logfile>3. Write a logfile</a></li><li><a href=#4-keep-erroractionpreference-set-to-continue>4. Keep $ErrorActionPreference set to Continue</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=best-practices>Best Practices
<a class=anchor href=#best-practices>#</a></h1><h2 id=1-search-for-and-install-updates-a-few-times-in-a-loop>1. Search for and install updates a few times in a loop
<a class=anchor href=#1-search-for-and-install-updates-a-few-times-in-a-loop>#</a></h2><p>Some packages and updates depend on others already being installed, so they might not show up during the first search for updates.
If you want to make sure &ldquo;everything&rdquo; has been installed and/or updated it is best to re-run
<code>Get-LSUpdate</code> and <code>Install-LSUpdate</code> a few times or until no more updates are found.</p><details><summary>Example</summary><div class=markdown-inner>This is a minimal example implementation of this best practice for demonstration purposes:<div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nv>$MaxRounds</span> <span class=p>=</span> <span class=mf>3</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=nv>$Round</span> <span class=p>=</span> <span class=mf>1</span><span class=p>;</span> <span class=nv>$Round</span> <span class=o>-le</span> <span class=nv>$MaxRounds</span><span class=p>;</span> <span class=nv>$Round</span><span class=p>++)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Starting round </span><span class=nv>$Round</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$updates</span> <span class=p>=</span> <span class=nb>Get-LSUpdate</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$updates</span><span class=p>.</span><span class=n>Count</span><span class=p>)</span><span class=s2> updates found&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$updates</span><span class=p>.</span><span class=py>Count</span> <span class=o>-eq</span> <span class=mf>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$updates</span> <span class=p>|</span> <span class=nb>Install-LSUpdate</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div></div></details><h2 id=2-download-all-packages-before-starting-to-install-any>2. Download all packages before starting to install any
<a class=anchor href=#2-download-all-packages-before-starting-to-install-any>#</a></h2><p>Installing a network (NIC, WiFi adapter) driver can cause a short loss of network connectivity. When you feed packages found by
<code>Get-LSUpdate</code> directly to <code>Install-LSUpdate</code> they will each be individually downloaded and then installed, therefore a network
driver installation can cause the following package downloads to fail (see <a href=https://github.com/jantari/LSUClient/issues/41>GitHub issue #41</a>).
Downloading all packages you intend to install beforehand with <code>Save-LSUpdate</code> will prevent this potential problem.</p><details><summary>Example</summary><div class=markdown-inner>This is a minimal example implementation of this best practice for demonstration purposes:<div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Find updates</span>
</span></span><span class=line><span class=cl><span class=nv>$updates</span> <span class=p>=</span> <span class=nb>Get-LSUpdate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Download them all to the local disk</span>
</span></span><span class=line><span class=cl><span class=nv>$updates</span> <span class=p>|</span> <span class=nb>Save-LSUpdate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Then install</span>
</span></span><span class=line><span class=cl><span class=nv>$updates</span> <span class=p>|</span> <span class=nb>Install-LSUpdate</span>
</span></span></code></pre></td></tr></table></div></div></div></div></details><blockquote class="book-hint info">If you download packages to a custom location with `Save-LSUpdate -Path` you have to pass that same path to `Install-LSUpdate -Path`
in order for it to find the previously downloaded files. If `Install-LSUpdate` cannot find the expected files locally, it will still
attempt to fetch them from the repository.</blockquote><h2 id=3-write-a-logfile>3. Write a logfile
<a class=anchor href=#3-write-a-logfile>#</a></h2><p>Especially when running unattended or remotely, it is crucial to have a good logfile that details what happened and allows you to find
the cause of a problem in retrospect.</p><p>If you don&rsquo;t know where to start, start with <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.host/start-transcript?view=powershell-5.1"><code>Start-Transcript</code></a> to log whatever is being output to the console.
If you would like more insight into what LSUClient is doing, add the common <code>-Verbose</code> parameter to the cmdlets you run.
If you are intimately familiar with Lenovos package XML format, perhaps even the output of <code>Get-LSUpdate -Verbose -Debug</code> will be useful to you.</p><details><summary>Example</summary><div class=markdown-inner>This is a minimal example implementation of this best practice for demonstration purposes:<div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Start-Transcript</span> <span class=n>-LiteralPath</span> <span class=s2>&#34;</span><span class=nv>$env:TEMP</span><span class=s2>\lsuclient_</span><span class=p>$(</span><span class=nb>Get-Date</span> <span class=n>-Format</span> <span class=s1>&#39;yyyyMMdd-HHmmss&#39;</span><span class=p>)</span><span class=s2>.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$updates</span> <span class=p>=</span> <span class=nb>Get-LSUpdate</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$updates</span><span class=p>.</span><span class=n>Count</span><span class=p>)</span><span class=s2> updates found&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$i</span> <span class=p>=</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$update</span> <span class=k>in</span> <span class=nv>$updates</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Installing update </span><span class=nv>$i</span><span class=s2> of </span><span class=p>$(</span><span class=nv>$updates</span><span class=p>.</span><span class=n>Count</span><span class=p>)</span><span class=s2>: </span><span class=p>$(</span><span class=nv>$update</span><span class=p>.</span><span class=n>Title</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Install-LSUpdate</span> <span class=n>-Package</span> <span class=nv>$update</span> <span class=n>-Verbose</span>
</span></span><span class=line><span class=cl>    <span class=nv>$i</span><span class=p>++</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Stop-Transcript</span>
</span></span></code></pre></td></tr></table></div></div></div></div></details><h2 id=4-keep-erroractionpreference-set-to-continue>4. Keep $ErrorActionPreference set to Continue
<a class=anchor href=#4-keep-erroractionpreference-set-to-continue>#</a></h2><p>Not every internal operation LSUClient carries out will and must neccesarily always succeed. Sometimes a file is
<a href=https://github.com/jantari/LSUClient/issues/80>in use by another process</a> or <a href=https://github.com/jantari/LSUClient/issues/37>just missing from Lenovos servers</a>.</p><p>Errors like these often only affect a single package out of many, and if they are severe enough that a particular package
cannot be processed further then it will be skipped, but all other packages can still be processed normally. This is the
behavior of PowerShells&rsquo; default <code>ErrorActionPreference</code> setting: <code>Continue</code>. LSUClient does not attempt to silence or hide
errors because they contain useful information about what went wrong and why. Particularly if you host your own package
repository, any repository-related failures for example are important to know about so you can address them.</p><p>So while it is a common best practice for PowerShell scripts, with <code>ErrorActionPreference</code> set to <code>Stop</code> one
of these &ldquo;small&rdquo; errors will always halt your entire script. Because of this I recommend against setting the
<code>ErrorActionPreference</code> to <code>Stop</code> in your LSUClient scripts.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#1-search-for-and-install-updates-a-few-times-in-a-loop>1. Search for and install updates a few times in a loop</a></li><li><a href=#2-download-all-packages-before-starting-to-install-any>2. Download all packages before starting to install any</a></li><li><a href=#3-write-a-logfile>3. Write a logfile</a></li><li><a href=#4-keep-erroractionpreference-set-to-continue>4. Keep $ErrorActionPreference set to Continue</a></li></ul></nav></div></aside></main></body></html>